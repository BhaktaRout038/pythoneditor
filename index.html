<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Python 3 Editor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/material.min.css">
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      height: 100vh;
      display: flex;
      flex-direction: column;
      background: #1e1e1e;
      color: white;
    }

    header {
      padding: 1rem;
      background: #333;
      font-size: 1.5rem;
      text-align: center;
    }

    main {
      flex: 1;
      display: flex;
      flex-direction: row;
      padding: 1rem;
      gap: 1rem;
    }

    #editorContainer, #outputContainer {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .CodeMirror {
      flex: 1;
      font-size: 16px;
      border: 1px solid #444;
    }

    #output {
      flex: 1;
      background: #000;
      padding: 10px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 14px;
      border: 1px solid #444;
      white-space: pre-wrap;
      color: #0f0;
    }

    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 10px;
      border-radius: 5px;
    }

    @media (max-width: 768px) {
      main {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>

  <header>üêç Python 3 Editor (Pyodide)</header>

  <main>
    <div id="editorContainer">
      <textarea id="editor">
print("Hello, World!")

x = "Python"
y = "is"
z = "awesome"
print(x, y, z)
      </textarea>
      <button onclick="runCode()">Run Python</button>
    </div>
    <div id="outputContainer">
      <div id="output">Loading Python...</div>
    </div>
  </main>

  <!-- CodeMirror -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/python/python.min.js"></script>

  <!-- Pyodide -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>

  <script>
    let pyodide;
    const output = document.getElementById("output");

    const editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
      mode: "python",
      theme: "material",
      lineNumbers: true,
      indentUnit: 4,
      tabSize: 4
    });

    async function loadPyodideAndPackages() {
      output.innerText = "Loading Pyodide...";
      pyodide = await loadPyodide();
      output.innerText = "Python 3 ready. Click 'Run Python'.";
    }

    loadPyodideAndPackages();

    async function runCode() {
      const code = editor.getValue();
      output.innerText = ""; // clear previous output

      try {
        // Redirect stdout and stderr
        let stdout = "";
        let stderr = "";

        await pyodide.runPythonAsync(`
import sys
from js import console

class StdoutCatcher:
    def __init__(self):
        self.data = ""
    def write(self, s):
        self.data += s
    def flush(self):
        pass

sys.stdout = StdoutCatcher()
sys.stderr = StdoutCatcher()
`);

        await pyodide.runPythonAsync(code);

        stdout = pyodide.runPython("sys.stdout.data");
        stderr = pyodide.runPython("sys.stderr.data");

        if (stdout.trim()) output.innerText += stdout;
        if (stderr.trim()) output.innerText += "\\n‚ùå Error:\\n" + stderr;
      } catch (err) {
        output.innerText += "‚ùå Exception:\n" + err;
      }
    }
  </script>
</body>
</html>
